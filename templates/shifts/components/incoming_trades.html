{% if incoming_trades %}
    <div class="mb-4">
        <div class="d-flex align-items-center mb-3 px-1">
            <h6 class="text-uppercase text-muted fw-bold small m-0 ls-1">
                <i class="bi bi-inbox-fill me-2 text-warning"></i>Solicitações Pendentes
            </h6>
            <span class="badge bg-warning text-dark rounded-pill ms-2 border border-warning-subtle">
                {{ incoming_trades|length }}
            </span>
        </div>
        <div class="d-flex flex-column gap-3">
            {% for trade in incoming_trades %}
                <div class="card border-0 shadow-sm border-start border-4 border-warning overflow-hidden">
                    <div class="card-body p-3">
                        <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3">
                            <div class="d-flex align-items-start gap-3">
                                <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center flex-shrink-0 fw-bold shadow-sm"
                                     style="width: 42px;
                                            height: 42px;
                                            font-size: 1.1rem">{{ trade.requester.email|slice:":1"|upper }}</div>
                                <div>
                                    <div class="mb-2">
                                        <span class="fw-bold text-dark">{{ trade.requester.email|truncatechars:30 }}</span>
                                        <span class="text-muted small">quer trocar com você.</span>
                                    </div>
                                    <div class="d-flex flex-wrap gap-2 align-items-center text-sm">
                                        <div class="bg-light border rounded px-2 py-1 text-muted small d-flex align-items-center">
                                            <i class="bi bi-arrow-down-left text-danger me-2"></i>
                                            <div>
                                                <span class="d-block lh-1" style="font-size: 0.7rem">SOLICITADO</span>
                                                <strong class="text-dark">{{ trade.target_shift.start_time|date:"d/m" }}</strong>
                                                <span class="opacity-75">({{ trade.target_shift.shift_type.name }})</span>
                                            </div>
                                        </div>
                                        <i class="bi bi-arrow-right text-muted opacity-50 d-none d-sm-block"></i>
                                        {% if trade.offered_shift %}
                                            <div class="bg-success-subtle border border-success-subtle text-success-emphasis rounded px-2 py-1 small d-flex align-items-center">
                                                <i class="bi bi-arrow-up-right text-success me-2"></i>
                                                <div>
                                                    <span class="d-block lh-1" style="font-size: 0.7rem">OFERTADO</span>
                                                    <strong>{{ trade.offered_shift.start_time|date:"d/m" }}</strong>
                                                    <span class="opacity-75">({{ trade.offered_shift.shift_type.name }})</span>
                                                </div>
                                            </div>
                                        {% else %}
                                            <div class="bg-info-subtle border border-info-subtle text-info-emphasis rounded px-2 py-1 small d-flex align-items-center">
                                                <i class="bi bi-gift-fill me-2"></i>
                                                <div>
                                                    <span class="d-block lh-1" style="font-size: 0.7rem">TIPO</span>
                                                    <strong>Doação</strong>
                                                    <span class="opacity-75">(Assume sem troca)</span>
                                                </div>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex align-items-center gap-2 align-self-end align-self-md-center mt-2 mt-md-0">
                                <form action="{% url 'accept_trade_request' trade.id %}" method="POST">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-success btn-sm fw-bold px-3 shadow-sm">
                                        <i class="bi bi-check-lg me-1"></i> Aceitar
                                    </button>
                                </form>
                                <form action="{% url 'reject_trade_request' trade.id %}" method="POST">
                                    {% csrf_token %}
                                    <button type="submit"
                                            class="btn btn-light btn-sm text-muted border px-3 hover-danger">
                                        Recusar
                                    </button>
                                </form>
                            </div>
                        </div>
                        {% if trade.message %}
                            <div class="mt-3 ms-5 ps-3 border-start border-3 small text-muted fst-italic">"{{ trade.message }}"</div>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
{% endif %}
