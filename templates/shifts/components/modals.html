{% include 'shifts/components/modals/create_shift.html' %}
{% include 'shifts/components/modals/create_group.html' %}
{% include 'shifts/components/modals/invite_modal.html' %}
{% include 'shifts/components/modals/join_group.html' %}
{% include 'shifts/components/modals/delete_confirm.html' %}
{% include 'shifts/components/modals/delete_group.html' %}
{% include 'shifts/components/modals/trade_proposal.html' %}
{% include 'shifts/components/modals/members_list.html' %}
<script>
    document.addEventListener('DOMContentLoaded', function() {

        // --- Lógica do Modal de Troca ---

        var tradeModal = document.getElementById('tradeProposalModal')
        if (tradeModal) {
            tradeModal.addEventListener('show.bs.modal', function(event) {
                var button = event.relatedTarget

                var shiftId = button.getAttribute('data-shift-id')
                var shiftInfo = button.getAttribute('data-shift-info')
                var shiftOwner = button.getAttribute('data-shift-owner')

                var modalTitle = tradeModal.querySelector('#targetShiftDisplay')
                var modalInput = tradeModal.querySelector('#targetShiftIdInput')
                var modalOwner = tradeModal.querySelector('#targetShiftOwner')

                if (modalTitle) modalTitle.textContent = shiftInfo
                if (modalInput) modalInput.value = shiftId
                if (modalOwner) modalOwner.textContent = shiftOwner
            })
        }

        // --- Lógica do Modal de Exclusão Genérico ---

        var deleteModal = document.getElementById('deleteModal')
        if (deleteModal) {
            deleteModal.addEventListener('show.bs.modal', function(event) {
                var button = event.relatedTarget
                var actionUrl = button.getAttribute('data-bs-action')
                var deleteForm = deleteModal.querySelector('#deleteForm')

                if (deleteForm && actionUrl) {
                    deleteForm.setAttribute('action', actionUrl)
                }
            })
        }
    });

    // Função para copiar link de convite

    function copyLink(event) {
        var copyText = document.getElementById("inviteLinkInput");
        if (copyText) {
            copyText.select();
            copyText.setSelectionRange(0, 99999);
            navigator.clipboard.writeText(copyText.value);

            var btn = event.target;
            var originalText = btn.innerText;
            btn.innerText = "Copiado!";
            setTimeout(function() {
                btn.innerText = originalText;
            }, 2000);
        }
    }

    // Função para filtras membros

    function filterMembers() {
        var input = document.getElementById('memberSearchInput');
        var filter = input.value.toLowerCase();

        var list = document.getElementById("membersList");
        var items = list.getElementsByClassName("member-item");
        var visibleCount = 0;

        for (var i = 0; i < items.length; i++) {
            var item = items[i];

            var nameEl = item.getElementsByClassName("member-name")[0];
            var emailEl = item.getElementsByClassName("member-email")[0];

            if (nameEl && emailEl) {
                var nameText = nameEl.textContent || nameEl.innerText;
                var emailText = emailEl.textContent || emailEl.innerText;
                var combinedText = (nameText + " " + emailText).toLowerCase();

                if (combinedText.indexOf(filter) > -1) {
                    item.classList.remove("d-none");
                    item.classList.add("d-flex");
                    visibleCount++;
                } else {
                    item.classList.add("d-none");
                    item.classList.remove("d-flex");
                }
            }
        }

        var noResults = document.getElementById("noResultsMessage");
        if (visibleCount === 0 && items.length > 0) {
            noResults.classList.remove("d-none");
        } else {
            noResults.classList.add("d-none");
        }
    }
</script>
